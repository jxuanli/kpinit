#!/bin/bash

# A simple wrapper script for a simple python3 http server
# I'm a bit paranoid and don't want to serve unnecessary files

if [ "$#" -lt 1 ] || [ ! -f "$1" ] || [ "$#" -gt 2 ]; then
  echo "Usage: $0 <file to serve> [port]"
  exit 1
fi

# https://stackoverflow.com/questions/12968093/regex-to-validate-port-number
re="^([1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$"
if [ "$#" -eq 2 ] && [[ ! $2 =~ $re ]]; then
  echo "port needs to be a numeric number between 0 and 65535."
  exit 1
fi

serving_dir="./util/exploit_serving/"
mkdir -p $serving_dir
cp $1 $serving_dir/exploit
python3 -m http.server -d $serving_dir $2
